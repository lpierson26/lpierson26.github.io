<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Locker Room Legends — Card Show Tables</title>

<style>
:root{
  --red:#dc2626;
  --blue:#1d4ed8;
  --white:#ffffff;
  --text:#0f172a;
  --muted:#64748b;
  --border:#e2e8f0;
  --card:#f8fafc;
  --good:#059669;
  --bad:#dc2626;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:linear-gradient(180deg,rgba(29,78,216,.06),rgba(220,38,38,.03));
  color:var(--text);
}
header{
  background:#fff;
  border-bottom:1px solid var(--border);
  padding:14px;
}
.brandBar{
  height:4px;
  background:linear-gradient(90deg,var(--blue),var(--white),var(--red));
  border-radius:999px;
  margin-bottom:10px;
}
.wrap{max-width:980px;margin:0 auto}
.row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.between{justify-content:space-between}
.logo{height:44px}
main{padding:14px}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  padding:14px;
  margin-bottom:14px;
}
.grid3{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px;
}
@media(max-width:900px){.grid3{grid-template-columns:1fr}}

.pill{
  font-size:12px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid var(--border);
  background:#fff;
}
.pill.good{color:var(--good)}
.pill.bad{color:var(--bad)}
.pill.blue{color:var(--blue)}

.title{font-weight:900}
.sub{font-size:13px;color:var(--muted)}

button,a.btn{
  border:none;
  border-radius:12px;
  padding:10px 12px;
  font-weight:800;
  cursor:pointer;
  background:var(--blue);
  color:#fff;
  text-decoration:none;
}
button.secondary,a.btn.secondary{
  background:#fff;
  color:var(--text);
  border:1px solid var(--border);
}

.progressWrap{
  margin-top:10px;
  height:10px;
  background:#fff;
  border:1px solid var(--border);
  border-radius:999px;
  overflow:hidden;
}
.bar{
  height:100%;
  background:linear-gradient(90deg,var(--blue),var(--red));
  width:0%;
}

label{display:block;margin:10px 0 6px;font-size:12px;color:var(--muted)}
input{
  width:100%;
  padding:10px;
  border-radius:12px;
  border:1px solid var(--border);
}
.notice{
  border:1px dashed var(--border);
  border-radius:12px;
  padding:10px;
  font-size:13px;
  color:var(--muted);
  background:#fff;
}
.hidden{display:none}

.modalOverlay{
  position:fixed;
  inset:0;
  background:rgba(15,23,42,.55);
  display:none;
  align-items:center;
  justify-content:center;
}
.modal{
  width:min(560px,100%);
  background:#fff;
  border-radius:16px;
  padding:14px;
}
.modalOverlay.show{display:flex}
</style>
</head>

<body>

<header>
  <div class="wrap">
    <div class="brandBar"></div>
    <div class="row between">
      <div class="row">
        <img src="logo.webp" class="logo">
        <div>
          <div class="title">Card Show Tables</div>
          <div class="sub">Reserve a vendor table</div>
        </div>
      </div>
      <div class="row">
        <a class="btn secondary" href="./index.html">← Home</a>
        <span id="statusPill" class="pill">Loading…</span>
      </div>
    </div>
  </div>
</header>

<main class="wrap">
<section class="card">
<div class="row between">
<div>
<div class="title">Available Shows</div>
<div class="sub">Counts update live</div>
</div>
<button id="btnRefresh" class="secondary">Refresh</button>
</div>

<div id="showsGrid" class="grid3" style="margin-top:12px"></div>
<div id="pageMsg" class="notice hidden"></div>
</section>
</main>

<!-- Modal -->
<div id="modalOverlay" class="modalOverlay">
<div class="modal">

<div class="row between">
<div>
<div class="title" id="mTitle"></div>
<div class="sub" id="mSub"></div>
</div>
<button id="mClose" class="secondary">✕</button>
</div>

<label>Name</label>
<input id="buyerName">

<label>Phone</label>
<input id="buyerPhone">

<label>Email</label>
<input id="buyerEmail">

<label>Venmo</label>
<input id="buyerVenmo">

<button id="mSubmit" style="margin-top:10px;width:100%">Reserve Table</button>
<div id="mMsg" class="notice hidden"></div>

</div>
</div>

<script>

const API_URL = "https://script.google.com/macros/s/AKfycbwJ43FEewVWRfjK2hZYFjEEYPEZmcWbC3nm5Mss_MnGRFnGF7LkOaux-AAWUGFrJlg/exec";

const showsGrid = document.getElementById("showsGrid");
const pageMsg = document.getElementById("pageMsg");
const statusPill = document.getElementById("statusPill");
const modalOverlay = document.getElementById("modalOverlay");
const mClose = document.getElementById("mClose");
const mSubmit = document.getElementById("mSubmit");
const mTitle = document.getElementById("mTitle");
const mSub = document.getElementById("mSub");
const mMsg = document.getElementById("mMsg");

const buyerName = document.getElementById("buyerName");
const buyerEmail = document.getElementById("buyerEmail");
const buyerPhone = document.getElementById("buyerPhone");
const buyerVenmo = document.getElementById("buyerVenmo");

let state = { shows: [], selected:null };

function show(el,html){el.classList.remove("hidden");el.innerHTML=html}
function hide(el){el.classList.add("hidden");el.innerHTML=""}

async function apiGetShows(){
const res = await fetch(API_URL);
const data = await res.json();
return data.tables || data.items || data.shows || [];
}

async function apiReserve(payload){
const res = await fetch(API_URL,{
method:"POST",
headers:{ "Content-Type":"text/plain;charset=utf-8"},
body:JSON.stringify(payload)
});
return await res.json();
}

function showKey(s){return String(s.tableID||s.tableId||s.id)}

function render(){
showsGrid.innerHTML="";
if(!state.shows.length){
show(pageMsg,"No shows found");
return;
}

state.shows.forEach(s=>{
const id=showKey(s);
const cap=Number(s.capacity||0);
const signed=Number(s.signedUp||0);
const left=Number(s.spotsLeft||cap-signed);
const open=left>0 && String(s.status).toUpperCase()=="OPEN";
const pct=cap? (signed/cap)*100 :0;

const div=document.createElement("div");
div.className="card";
div.innerHTML=`
<div class="title">${s.title}</div>
<div class="sub">${s.desc}</div>

<div class="row between">
<span class="pill blue">$${s.price}</span>
<span class="pill ${open?"good":"bad"}">${open?"OPEN":"CLOSED"}</span>
</div>

<div class="row">
<span class="pill">${signed}/${cap}</span>
<span class="pill">${left} left</span>
</div>

<div class="progressWrap"><div class="bar" style="width:${pct}%"></div></div>

<button data-id="${id}" ${open?"":"disabled"} style="margin-top:10px;width:100%">
Reserve Table
</button>
`;
showsGrid.appendChild(div);
});

document.querySelectorAll("[data-id]").forEach(b=>{
b.onclick=()=>openModal(b.dataset.id);
});
}

function openModal(id){
state.selected=state.shows.find(s=>showKey(s)==id);
mTitle.textContent=state.selected.title;
mSub.textContent="Reserve 1 table";
modalOverlay.classList.add("show");
}

function closeModal(){modalOverlay.classList.remove("show")}

async function submitReserve(){
const s=state.selected;
const payload={
tableID:showKey(s),
name:buyerName.value,
email:buyerEmail.value,
phone:buyerPhone.value,
venmo:buyerVenmo.value
};
await apiReserve(payload);
show(mMsg,"Reserved!");
refresh();
}

async function refresh(){
state.shows=await apiGetShows();
render();
}

mSubmit.onclick=submitReserve;
mClose.onclick=closeModal;
document.getElementById("btnRefresh").onclick=refresh;

refresh();

</script>
</body>
</html>
