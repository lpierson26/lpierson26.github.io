<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Spin to Win — Venmo Only</title>

<style>
:root{
  --red:#dc2626;
  --blue:#1d4ed8;
  --white:#ffffff;
  --text:#0f172a;
  --muted:#64748b;
  --border:#e2e8f0;
  --card:#f8fafc;
  --good:#059669;
  --bad:#dc2626;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:linear-gradient(180deg,rgba(29,78,216,.06),rgba(220,38,38,.03));
  color:var(--text);
}
header{
  background:#fff;
  border-bottom:1px solid var(--border);
  padding:14px;
}
.brandBar{
  height:4px;
  background:linear-gradient(90deg,var(--blue),var(--white),var(--red));
  border-radius:999px;
  margin-bottom:10px;
}
.wrap{max-width:980px;margin:0 auto}
.row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.between{justify-content:space-between}
.logo{height:44px;object-fit:contain}
main{padding:14px}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  padding:14px;
  margin-bottom:14px;
}
.grid3{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px;
}
@media(max-width:900px){.grid3{grid-template-columns:1fr}}
.pill{
  font-size:12px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid var(--border);
  background:#fff;
}
.pill.good{color:var(--good)}
.pill.bad{color:var(--bad)}
.pill.blue{color:var(--blue)}
.title{font-weight:900}
.sub{font-size:13px;color:var(--muted)}

button,a.btn{
  border:none;
  border-radius:12px;
  padding:10px 12px;
  font-weight:800;
  cursor:pointer;
  background:var(--blue);
  color:#fff;
  text-decoration:none;
}
button.secondary{
  background:#fff;
  color:var(--text);
  border:1px solid var(--border);
}
button:disabled{opacity:.5; cursor:not-allowed}

/* ✅ single photo centered */
.photos{display:flex;justify-content:center;margin-top:10px}
.photo{
  border:1px solid var(--border);
  border-radius:12px;
  overflow:hidden;
  background:#fff;
}
.photo img{
  width:100%;
  max-width:320px;
  height:180px;
  object-fit:contain;
  display:block;
}

.progressWrap{
  margin-top:10px;
  height:10px;
  background:#fff;
  border:1px solid var(--border);
  border-radius:999px;
  overflow:hidden;
}
.bar{
  height:100%;
  background:linear-gradient(90deg,var(--blue),var(--red));
  width:0%;
}

.hidden{display:none}
.notice{
  margin-top:10px;
  border:1px dashed var(--border);
  border-radius:12px;
  padding:10px;
  font-size:13px;
  color:var(--muted);
  background:#fff;
}

/* form bits */
label{display:block;margin:10px 0 6px;font-size:12px;color:var(--muted)}
input,select{
  width:100%;
  padding:10px 10px;
  border-radius:12px;
  border:1px solid var(--border);
  background:#fff;
  font-size:14px;
}
.hr{height:1px;background:var(--border);margin:12px 0}

</style>
</head>

<body>

<header>
  <div class="wrap">
    <div class="brandBar"></div>
    <div class="row between">
      <div class="row">
        <!-- ✅ your logo filename -->
        <img src="logo.webp" class="logo" alt="Locker Room Legends">
        <div>
          <div class="title">Spin to Win</div>
          <div class="sub"><strong>Venmo only.</strong> Pay → return → submit. When full, the wheel spins.</div>
        </div>
      </div>
    </div>
  </div>
</header>

<main class="wrap">

<!-- PAGE 1 -->
<section id="pagePick" class="card">
  <div class="row between">
    <div>
      <div class="title">Pick a Spin</div>
      <div class="sub">Choose an option to sign up.</div>
    </div>
    <span id="globalStatus" class="pill">Open</span>
  </div>

  <div id="spinCards" class="grid3" style="margin-top:12px"></div>

  <div class="notice">
    This version stores entries on <strong>this device</strong> (localStorage). If you need shared entries for everyone online, you’ll need a Google Sheet / backend.
  </div>
</section>

<!-- PAGE 2 -->
<section id="pageSignup" class="card hidden">
  <div class="row between">
    <div>
      <div class="title" id="signupTitle">Sign up</div>
      <div class="sub" id="signupDesc"></div>
    </div>
    <button id="btnBack" class="secondary">← Back</button>
  </div>

  <div class="row" style="margin-top:10px;gap:10px">
    <span class="pill blue" id="signupPrice">$0</span>
    <span class="pill" id="signupFill">0/0 filled</span>
    <span class="pill" id="signupSpots">0 spots left</span>
    <span class="pill" id="signupStatus">Open</span>
  </div>

  <div class="progressWrap" aria-label="fill progress">
    <div class="bar" id="signupBar"></div>
  </div>

  <div class="photos" id="signupPhotoWrap"></div>

  <div class="hr"></div>

  <div class="row" style="gap:10px">
    <div style="flex:1;min-width:240px">
      <label for="name">Name</label>
      <input id="name" placeholder="Your name" autocomplete="name" />
    </div>
    <div style="flex:1;min-width:240px">
      <label for="phone">Phone</label>
      <input id="phone" placeholder="(###) ###-####" autocomplete="tel" />
    </div>
  </div>

  <div class="row" style="gap:10px">
    <div style="flex:1;min-width:240px">
      <label for="email">Email</label>
      <input id="email" placeholder="you@email.com" autocomplete="email" />
    </div>
    <div style="flex:1;min-width:240px">
      <label for="venmo">Venmo username</label>
      <input id="venmo" placeholder="@yourVenmo" />
    </div>
  </div>

  <div class="row" style="margin-top:10px">
    <button id="btnSubmit" style="width:100%">Submit Entry (adds name to wheel)</button>
  </div>

  <div id="msg" class="notice hidden"></div>
</section>

</main>

<script>
<script>
/** ====== CONFIG ====== */
const API_URL = "https://script.google.com/macros/s/AKfycbwYgaxll6VfAmw8lqejfI2cKVSBpeBuc5iyPd8kXinLZBUR8Hj95hTO8dvROP49oH9Vvg/exec";

/** ====== ELEMENTS ====== */
const pagePick = document.getElementById("pagePick");
const pageSignup = document.getElementById("pageSignup");
const spinCards = document.getElementById("spinCards");
const globalStatus = document.getElementById("globalStatus");

const btnBack = document.getElementById("btnBack");
const btnSubmit = document.getElementById("btnSubmit");

const signupTitle = document.getElementById("signupTitle");
const signupDesc = document.getElementById("signupDesc");
const signupPrice = document.getElementById("signupPrice");
const signupFill = document.getElementById("signupFill");
const signupSpots = document.getElementById("signupSpots");
const signupBar = document.getElementById("signupBar");
const signupPhotoWrap = document.getElementById("signupPhotoWrap");
const signupStatus = document.getElementById("signupStatus");

const nameEl = document.getElementById("name");
const phoneEl = document.getElementById("phone");
const emailEl = document.getElementById("email");
const venmoEl = document.getElementById("venmo");
const msg = document.getElementById("msg");

/** ====== STATE ====== */
let SPINS = [];
let selectedSpinId = null;

/** ====== HELPERS ====== */
function showMsg(html){
  if(!msg) return;
  msg.classList.remove("hidden");
  msg.innerHTML = html;
}
function clearMsg(){
  if(!msg) return;
  msg.classList.add("hidden");
  msg.innerHTML = "";
}
function validEmail(v){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v||""); }
function escapeHtml(str){
  return String(str||"").replace(/[&<>"']/g, m => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
  }[m]));
}

/** normalize fields from API */
function normSpin(s){
  const spinId = String(s.spinId ?? s.id ?? "").trim();
  const entryPrice = Number(s.entryPrice ?? s.price ?? 0) || 0;
  const capacity = Number(s.capacity ?? 0) || 0;
  const signedUp = Number(s.signedUp ?? 0) || 0;
  const spotsLeft = (s.spotsLeft !== undefined && s.spotsLeft !== null)
    ? (Number(s.spotsLeft) || 0)
    : Math.max(0, capacity - signedUp);

  return {
    ...s,
    spinId,
    entryPrice,
    capacity,
    signedUp,
    spotsLeft,
    status: String(s.status ?? "OPEN").toUpperCase()
  };
}

function getSpin(spinId){
  return SPINS.find(s => String(s.spinId) === String(spinId));
}

/** ====== API ====== */
async function apiGetSpins(){
  const res = await fetch(`${API_URL}?ts=${Date.now()}`, { method:"GET" });
  const data = await res.json();
  if(!data.ok) throw new Error(data.error || "Failed to load spins");
  SPINS = (data.spins || []).map(normSpin);
}

async function apiPostEntry(payload){
  const res = await fetch(API_URL, {
    method:"POST",
    headers:{ "Content-Type":"text/plain;charset=utf-8" }, // GAS-friendly
    body: JSON.stringify(payload)
  });
  const data = await res.json();
  if(!data.ok) throw new Error(data.error || "Submit error");
  return data;
}

/** ====== NAV ====== */
function goSignup(spinId){
  selectedSpinId = spinId;
  clearMsg();
  nameEl.value=""; phoneEl.value=""; emailEl.value=""; venmoEl.value="";
  pagePick.classList.add("hidden");
  pageSignup.classList.remove("hidden");
  renderSignup();
}

function goPick(){
  selectedSpinId = null;
  clearMsg();
  pageSignup.classList.add("hidden");
  pagePick.classList.remove("hidden");
  renderPick();
}

/** ====== RENDER PICK ====== */
function renderPick(){
  spinCards.innerHTML = "";
  let anyOpen = false;

  SPINS.forEach(s=>{
    const open = (s.status === "OPEN") && (s.spotsLeft > 0);
    if(open) anyOpen = true;

    const pct = s.capacity ? Math.min(100, (s.signedUp / s.capacity) * 100) : 0;

    const div = document.createElement("div");
    div.className = "card";
    div.style.background = "#fff";
    div.innerHTML = `
      <div class="row between">
        <div>
          <div class="title">${escapeHtml(s.title || "")}</div>
          <div class="sub">${escapeHtml(s.desc || "")}</div>
        </div>
        <span class="pill blue">$${s.entryPrice}</span>
      </div>

      <div class="row" style="margin-top:6px">
        <span class="pill">${s.signedUp}/${s.capacity} filled</span>
        <span class="pill ${open ? "good":"bad"}">${open ? "Open":"Full"}</span>
      </div>

      <div class="progressWrap">
        <div class="bar" style="width:${pct}%"></div>
      </div>

      <div class="photos">
        ${s.photo ? `<div class="photo"><img src="${s.photo}" alt="Spin photo"></div>` : ""}
      </div>

      <button data-pick="${escapeHtml(s.spinId)}" ${open ? "" : "disabled"} style="margin-top:10px;width:100%">
        ${open ? "Choose Spin" : "Full"}
      </button>
    `;
    spinCards.appendChild(div);
  });

  globalStatus.textContent = anyOpen ? "Open" : "All Full";
  globalStatus.className = `pill ${anyOpen ? "good":"bad"}`;

  spinCards.querySelectorAll("button[data-pick]").forEach(btn=>{
    btn.addEventListener("click", ()=> goSignup(btn.getAttribute("data-pick")));
  });
}

/** ====== RENDER SIGNUP ====== */
function renderSignup(){
  const s = getSpin(selectedSpinId);
  if(!s) return;

  const pct = s.capacity ? Math.min(100, Math.round((s.signedUp / s.capacity) * 100)) : 0;
  const open = (s.status === "OPEN") && (s.spotsLeft > 0);

  signupTitle.textContent = `Sign up — ${s.title || ""}`;
  signupDesc.textContent = s.desc || "";
  signupPrice.textContent = `$${s.entryPrice} per entry`;
  signupFill.textContent = `${s.signedUp}/${s.capacity} filled`;
  signupSpots.textContent = `${s.spotsLeft} spots left`;
  signupBar.style.width = pct + "%";

  signupStatus.textContent = open ? "Open" : "Full";
  signupStatus.className = `pill ${open ? "good":"bad"}`;

  signupPhotoWrap.innerHTML = s.photo
    ? `<div class="photo"><img src="${s.photo}" alt="Spin photo"></div>`
    : "";

  btnSubmit.disabled = !open;
}

/** ====== SUBMIT ====== */
async function submitEntry(){
  clearMsg();

  const s = getSpin(selectedSpinId);
  if(!s) return showMsg("<strong>Error:</strong> Spin not found.");

  const name = nameEl.value.trim();
  const phone = phoneEl.value.trim();
  const email = emailEl.value.trim();
  const venmo = venmoEl.value.trim();

  if(!name) return showMsg("Please enter your <strong>name</strong>.");
  if(!phone) return showMsg("Please enter your <strong>phone</strong>.");
  if(!email || !validEmail(email)) return showMsg("Please enter a valid <strong>email</strong>.");
  if(!venmo) return showMsg("Please enter your <strong>Venmo username</strong>.");

  btnSubmit.disabled = true;
  const oldText = btnSubmit.textContent;
  btnSubmit.textContent = "Submitting…";

  try{
    await apiPostEntry({ spinId: s.spinId, name, phone, email, venmo });

    // refresh spins & counts
    await apiGetSpins();
    renderPick();
    renderSignup();

    showMsg(
      `<strong>Entry submitted ✅</strong><br/>
       We added you to <strong>${escapeHtml(s.title || s.spinId)}</strong>.<br/>
       Please pay <strong>$${s.entryPrice}</strong> via Venmo and include your name in the note.`
    );
  }catch(err){
    showMsg(`<strong>Error:</strong> ${escapeHtml(err.message || String(err))}`);
  }finally{
    btnSubmit.textContent = oldText || "Submit Entry";
    const s2 = getSpin(selectedSpinId);
    btnSubmit.disabled = !(s2 && s2.status === "OPEN" && s2.spotsLeft > 0);
  }
}

btnBack.addEventListener("click", goPick);
btnSubmit.addEventListener("click", submitEntry);

/** ====== INIT ====== */
(async function init(){
  try{
    await apiGetSpins();
    renderPick();
  }catch(err){
    console.error(err);
    showMsg(
      `<strong>Could not load spins.</strong><br/>
       ${escapeHtml(err.message || String(err))}<br/><br/>
       Check that your Apps Script Web App is deployed as <strong>Anyone</strong>.`
    );
  }
})();
</script>

</script>

</body>
</html>
