<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Spin to Win — Venmo Only</title>

<style>
:root{
  --red:#dc2626;
  --blue:#1d4ed8;
  --white:#ffffff;
  --text:#0f172a;
  --muted:#64748b;
  --border:#e2e8f0;
  --card:#f8fafc;
  --good:#059669;
  --bad:#dc2626;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:linear-gradient(180deg,rgba(29,78,216,.06),rgba(220,38,38,.03));
  color:var(--text);
}
header{
  background:#fff;
  border-bottom:1px solid var(--border);
  padding:14px;
}
.brandBar{
  height:4px;
  background:linear-gradient(90deg,var(--blue),var(--white),var(--red));
  border-radius:999px;
  margin-bottom:10px;
}
.wrap{max-width:980px;margin:0 auto}
.row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.between{justify-content:space-between}
.logo{height:44px;object-fit:contain}
main{padding:14px}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  padding:14px;
  margin-bottom:14px;
}
.grid3{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px;
}
@media(max-width:900px){.grid3{grid-template-columns:1fr}}
.pill{
  font-size:12px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid var(--border);
  background:#fff;
}
.pill.good{color:var(--good)}
.pill.bad{color:var(--bad)}
.pill.blue{color:var(--blue)}
.title{font-weight:900}
.sub{font-size:13px;color:var(--muted)}

button,a.btn{
  border:none;
  border-radius:12px;
  padding:10px 12px;
  font-weight:800;
  cursor:pointer;
  background:var(--blue);
  color:#fff;
  text-decoration:none;
}
button.secondary{
  background:#fff;
  color:var(--text);
  border:1px solid var(--border);
}
button:disabled{opacity:.5; cursor:not-allowed}

/* ✅ single photo centered */
.photos{display:flex;justify-content:center;margin-top:10px}
.photo{
  border:1px solid var(--border);
  border-radius:12px;
  overflow:hidden;
  background:#fff;
}
.photo img{
  width:100%;
  max-width:320px;
  height:180px;
  object-fit:contain;
  display:block;
}

.progressWrap{
  margin-top:10px;
  height:10px;
  background:#fff;
  border:1px solid var(--border);
  border-radius:999px;
  overflow:hidden;
}
.bar{
  height:100%;
  background:linear-gradient(90deg,var(--blue),var(--red));
  width:0%;
}

.hidden{display:none}
.notice{
  margin-top:10px;
  border:1px dashed var(--border);
  border-radius:12px;
  padding:10px;
  font-size:13px;
  color:var(--muted);
  background:#fff;
}

/* form bits */
label{display:block;margin:10px 0 6px;font-size:12px;color:var(--muted)}
input,select{
  width:100%;
  padding:10px 10px;
  border-radius:12px;
  border:1px solid var(--border);
  background:#fff;
  font-size:14px;
}
.hr{height:1px;background:var(--border);margin:12px 0}

/* wheel */
.wheelWrap{
  display:flex;
  gap:14px;
  align-items:flex-start;
  flex-wrap:wrap;
  margin-top:12px;
}
canvas{
  background:#fff;
  border:1px solid var(--border);
  border-radius:14px;
  box-shadow:0 10px 18px rgba(15,23,42,.06);
}
.wheelSide{
  min-width:240px;
  flex:1;
}
.small{font-size:12px;color:var(--muted)}
.list{
  background:#fff;
  border:1px solid var(--border);
  border-radius:14px;
  padding:10px;
  max-height:240px;
  overflow:auto;
}
.list div{
  padding:6px 8px;
  border-bottom:1px solid var(--border);
  font-size:13px;
}
.list div:last-child{border-bottom:none}
</style>
</head>

<body>

<header>
  <div class="wrap">
    <div class="brandBar"></div>
    <div class="row between">
      <div class="row">
        <!-- ✅ your logo filename -->
        <img src="logo.webp" class="logo" alt="Locker Room Legends">
        <div>
          <div class="title">Spin to Win</div>
          <div class="sub"><strong>Venmo only.</strong> Pay → return → submit. When full, the wheel spins.</div>
        </div>
      </div>
      <div class="row">
        <button id="btnReset" class="secondary">Reset</button>
      </div>
    </div>
  </div>
</header>

<main class="wrap">

<!-- PAGE 1 -->
<section id="pagePick" class="card">
  <div class="row between">
    <div>
      <div class="title">Pick a Spin</div>
      <div class="sub">Choose an option to sign up.</div>
    </div>
    <span id="globalStatus" class="pill">Open</span>
  </div>

  <div id="spinCards" class="grid3" style="margin-top:12px"></div>

  <div class="notice">
    This version stores entries on <strong>this device</strong> (localStorage). If you need shared entries for everyone online, you’ll need a Google Sheet / backend.
  </div>
</section>

<!-- PAGE 2 -->
<section id="pageSignup" class="card hidden">
  <div class="row between">
    <div>
      <div class="title" id="signupTitle">Sign up</div>
      <div class="sub" id="signupDesc"></div>
    </div>
    <button id="btnBack" class="secondary">← Back</button>
  </div>

  <div class="row" style="margin-top:10px;gap:10px">
    <span class="pill blue" id="signupPrice">$0</span>
    <span class="pill" id="signupFill">0/0 filled</span>
    <span class="pill" id="signupSpots">0 spots left</span>
    <span class="pill" id="signupStatus">Open</span>
  </div>

  <div class="progressWrap" aria-label="fill progress">
    <div class="bar" id="signupBar"></div>
  </div>

  <div class="photos" id="signupPhotoWrap"></div>

  <div class="wheelWrap">
    <canvas id="wheel" width="360" height="360"></canvas>
    <div class="wheelSide">
      <div class="title" style="margin-bottom:6px">Wheel Entries</div>
      <div class="small">Names added after submit. When full, it spins automatically.</div>
      <div class="list" id="entryList" style="margin-top:10px"></div>

      <div class="row" style="margin-top:10px">
        <button id="btnSpinNow" class="secondary">Spin Now</button>
      </div>
      <div class="notice hidden" id="winnerBox"></div>
    </div>
  </div>

  <div class="hr"></div>

  <div class="row" style="gap:10px">
    <div style="flex:1;min-width:240px">
      <label for="name">Name</label>
      <input id="name" placeholder="Your name" autocomplete="name" />
    </div>
    <div style="flex:1;min-width:240px">
      <label for="phone">Phone</label>
      <input id="phone" placeholder="(###) ###-####" autocomplete="tel" />
    </div>
  </div>

  <div class="row" style="gap:10px">
    <div style="flex:1;min-width:240px">
      <label for="email">Email</label>
      <input id="email" placeholder="you@email.com" autocomplete="email" />
    </div>
    <div style="flex:1;min-width:240px">
      <label for="venmo">Venmo username</label>
      <input id="venmo" placeholder="@yourVenmo" />
    </div>
  </div>

  <div class="row" style="margin-top:10px">
    <button id="btnSubmit" style="width:100%">Submit Entry (adds name to wheel)</button>
  </div>

  <div id="msg" class="notice hidden"></div>
</section>

</main>

<script>
/** ====== CONFIG ====== */
const API_URL = "https://script.google.com/macros/s/AKfycbynMDQcCFQV4NHn59mMFBfgc6A1s6zTqa6SBLVjf6iXECp3gs3TNpqZUogwhWNk2BESZg/exec"; // <-- required

// spins shown on the site (Sheet holds the live counts + entries)
const SPINS = [
  { id:"spin1", title:"Jersey Spin #1", desc:"Duke Boozer #12 Jersey", entryPrice:100, capacity:20, photo:"boozer.jpg" },
  { id:"spin2", title:"Jersey Spin #2", desc:"Duke Evans #3 Jersey", entryPrice:80,  capacity:25, photo:"evans.jpeg" },
  { id:"spin3", title:"Jersey Spin #3", desc:"Illinois Wagler #23 Jersey", entryPrice:10,  capacity:20, photo:"test.webp" }
];

/** ====== ELEMENTS (these IDs already exist in your HTML) ====== */
const pagePick=document.getElementById("pagePick");
const pageSignup=document.getElementById("pageSignup");
const spinCards=document.getElementById("spinCards");
const globalStatus=document.getElementById("globalStatus");

const btnBack=document.getElementById("btnBack");
const btnSubmit=document.getElementById("btnSubmit");

const signupTitle=document.getElementById("signupTitle");
const signupDesc=document.getElementById("signupDesc");
const signupPrice=document.getElementById("signupPrice");
const signupFill=document.getElementById("signupFill");
const signupSpots=document.getElementById("signupSpots");
const signupBar=document.getElementById("signupBar");
const signupPhotoWrap=document.getElementById("signupPhotoWrap");

const nameEl=document.getElementById("name");
const phoneEl=document.getElementById("phone");
const emailEl=document.getElementById("email");
const venmoEl=document.getElementById("venmo");
const msg=document.getElementById("msg");

let selectedSpinId=null;
let statusById={}; // spinId -> {filled, capacity}

/** ====== HELPERS ====== */
function showMsg(html){
  msg.classList.remove("hidden");
  msg.innerHTML=html;
}
function clearMsg(){
  msg.classList.add("hidden");
  msg.innerHTML="";
}
function validEmail(v){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v||""); }

function getSpin(id){ return SPINS.find(s=>s.id===id); }
function filled(id){ return (statusById[id]?.filled ?? 0); }
function capacity(id){ return (statusById[id]?.capacity ?? getSpin(id)?.capacity ?? 0); }
function remaining(id){ return Math.max(0, capacity(id)-filled(id)); }

/** ====== API ====== */
async function fetchStatus(){
  const res = await fetch(`${API_URL}?action=status`, { method:"GET" });
  const data = await res.json();
  if(!data.ok) throw new Error(data.error || "Status error");
  statusById = {};
  data.spins.forEach(s=>{
    statusById[s.id] = { filled: s.filled, capacity: s.capacity };
  });
}

async function postEntry(payload){
  const res = await fetch(API_URL, {
    method:"POST",
    headers:{ "Content-Type":"text/plain;charset=utf-8" }, // GAS-friendly
    body: JSON.stringify(payload)
  });
  const data = await res.json();
  if(!data.ok) throw new Error(data.error || "Submit error");
  return data;
}

/** ====== UI NAV ====== */
function goSignup(id){
  selectedSpinId=id;
  clearMsg();
  nameEl.value=""; phoneEl.value=""; emailEl.value=""; venmoEl.value="";
  pagePick.classList.add("hidden");
  pageSignup.classList.remove("hidden");
  renderSignup();
}
function goPick(){
  selectedSpinId=null;
  clearMsg();
  pageSignup.classList.add("hidden");
  pagePick.classList.remove("hidden");
  renderPick();
}

/** ====== RENDER ====== */
function renderPick(){
  spinCards.innerHTML="";
  let anyOpen=false;

  SPINS.forEach(s=>{
    const cap = capacity(s.id);
    const f = filled(s.id);
    const rem = Math.max(0, cap - f);
    if(rem>0) anyOpen=true;

    const div=document.createElement("div");
    div.className="card";
    div.style.background="#fff";
    div.innerHTML=`
      <div class="row between">
        <div>
          <div class="title">${s.title}</div>
          <div class="sub">${s.desc}</div>
        </div>
        <span class="pill blue">$${s.entryPrice}</span>
      </div>

      <div class="row" style="margin-top:6px">
        <span class="pill">${f}/${cap} filled</span>
        <span class="pill ${rem>0?"good":"bad"}">${rem>0?"Open":"Full"}</span>
      </div>

      <div class="progressWrap">
        <div class="bar" style="width:${cap?Math.min(100,(f/cap)*100):0}%"></div>
      </div>

      <div class="photos">
        ${s.photo ? `<div class="photo"><img src="${s.photo}" alt="Jersey photo"></div>` : ""}
      </div>

      <button data-pick="${s.id}" ${rem<=0?"disabled":""} style="margin-top:10px;width:100%">
        ${rem<=0?"Full":"Choose Spin"}
      </button>
    `;
    spinCards.appendChild(div);
  });

  globalStatus.textContent=anyOpen?"Open":"All Full";
  globalStatus.className=`pill ${anyOpen?"good":"bad"}`;

  spinCards.querySelectorAll("button[data-pick]").forEach(btn=>{
    btn.addEventListener("click", ()=> goSignup(btn.getAttribute("data-pick")));
  });
}

function renderSignup(){
  const s=getSpin(selectedSpinId);
  if(!s) return;

  const cap = capacity(s.id);
  const f = filled(s.id);
  const rem = Math.max(0, cap-f);
  const pct = cap?Math.min(100, Math.round((f/cap)*100)):0;

  signupTitle.textContent=`Sign up — ${s.title}`;
  signupDesc.textContent=s.desc;
  signupPrice.textContent=`$${s.entryPrice} per entry`;
  signupFill.textContent=`${f}/${cap} filled`;
  signupSpots.textContent=`${rem} spots left`;
  signupBar.style.width=pct+"%";

  signupPhotoWrap.innerHTML = s.photo
    ? `<div class="photo"><img src="${s.photo}" alt="Jersey photo"></div>`
    : "";

  btnSubmit.disabled = (rem<=0);
}

/** ====== SUBMIT ====== */
async function submitEntry(){
  clearMsg();
  const s=getSpin(selectedSpinId);
  if(!s) return;

  try{
    btnSubmit.disabled = true;
    btnSubmit.textContent = "Submitting…";

    // refresh counts right before submit
    await fetchStatus();
    renderSignup();

    if(remaining(s.id) <= 0){
      showMsg("<strong>Sorry — this spin just filled.</strong> Please go back and choose another.");
      return;
    }

    const name=nameEl.value.trim();
    const phone=phoneEl.value.trim();
    const email=emailEl.value.trim();
    const venmo=venmoEl.value.trim();

    if(!name){ showMsg("Please enter your <strong>name</strong>."); return; }
    if(!phone){ showMsg("Please enter your <strong>phone</strong>."); return; }
    if(!email || !validEmail(email)){ showMsg("Please enter a valid <strong>email</strong>."); return; }
    if(!venmo){ showMsg("Please enter your <strong>Venmo username</strong>."); return; }

    await postEntry({ spinId: s.id, name, phone, email, venmo });

    // pull latest counts after submit
    await fetchStatus();
    renderPick();
    renderSignup();

    showMsg("<strong>Entry submitted!</strong> Your spot is reserved. Please pay on Venmo and use the same name/handle so it matches.");

  }catch(err){
    showMsg(`<strong>Error:</strong> ${String(err.message || err)}`);
  }finally{
    btnSubmit.textContent = "Submit Entry";
    btnSubmit.disabled = (selectedSpinId ? remaining(selectedSpinId)<=0 : false);
  }
}

btnBack.addEventListener("click", goPick);
btnSubmit.addEventListener("click", submitEntry);

/** ====== INIT + AUTO-REFRESH ====== */
(async function init(){
  try{
    await fetchStatus();
  }catch(err){
    showMsg(`<strong>Can’t reach sign-up server yet.</strong><br/>Paste your Apps Script URL into <code>API_URL</code>.<br/><span class="small">${String(err.message || err)}</span>`);
  }
  renderPick();
})();

// refresh counts every 15 seconds
setInterval(async ()=>{
  try{
    await fetchStatus();
    if(!selectedSpinId) renderPick();
    else renderSignup();
  }catch(e){}
}, 15000);
</script>

</body>
</html>
